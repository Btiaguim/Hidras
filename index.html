<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Registo de Hidras - Metin2</title>
<style>
  body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; margin:0; padding:0; }
  .container { display: flex; width: 100%; min-height: 100vh; justify-content: space-around; align-items: flex-start; padding: 20px; box-sizing: border-box; }
  .section { background: #2b2b2b; padding: 20px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.5); width: 30%; }
  .section h2 { text-align: center; }
  button, input, select { color: #fff; background: #3a3a3a; padding: 10px; margin-top: 10px; border-radius: 8px; border: none; font-size: 16px; width: 100%; box-sizing: border-box; }
  button { background: #4CAF50; cursor: pointer; }
  button:hover { background: #45a049; }
  .timer { font-size: 24px; text-align: center; margin-top: 15px; }
  .hidra-icon, .cofre-icon { width: 24px; height: 24px; vertical-align: middle; margin-right: 5px; }
  .banner { width: 100%; border-radius: 12px; margin-bottom: 20px; }
  #historicoDia { max-height: 200px; overflow-y: auto; padding-left: 10px; margin-top: 10px; }
</style>
</head>
<body>

<img src="https://image.board.gameforge.com/uploads/metin2/de/announcement_metin2_de_b9a65d2955858ca2f0b20ab0e2de48d2.jpg" alt="Banner Hidra Tracker" class="banner" />

<div class="container">
  <!-- Timer Section -->
  <div class="section" id="timerSection">
    <h2>Timer da Hidra (20 min)</h2>
    <button onclick="iniciarTimer()">Iniciar</button>
    <button onclick="pararTimer()">Parar</button>
    <button onclick="resetarTimer()">Resetar</button>
    <div id="timer" class="timer">20:00</div>
  </div>

  <!-- Hidra Info Section -->
  <div class="section" id="hidraInfo">
    <h2>Registo de Hidras</h2>
    <label>Total Hidras Mortas:</label>
    <input type="number" id="hidras" value="0" disabled />

    <label>Cofres Dropados (0-5):</label>
    <input type="number" id="cofresInput" placeholder="Digite os cofres da última hidra" min="0" max="5" />

    <label>Preço médio do Cofre (kk):</label>
    <input type="number" id="precoCofre" placeholder="36 a 40" min="36" max="40" />

    <button onclick="registrarHidra()">Registrar Hidra</button>

    <h3>Cofres Totais: <img src="https://metin2cms.cf/items/img/icons/54705.png" alt="Cofre" class="cofre-icon" /><span id="cofresTotal">0</span></h3>
    <h3>Média por Hidra: <span id="media">0</span></h3>
    <h3>Total Hidras: <span id="totalHidras">0</span></h3>
    <h3>Ganhos: <span id="ganhosWon">0 W</span></h3>

    <label>Selecionar Dia:</label>
    <select id="selecionarDia" onchange="mostrarDiaSelecionado()"></select>
    <div id="historicoDia"></div>
  </div>

  <!-- Admin Section -->
  <div class="section" id="adminSectionContainer">
    <h2>Área Administrativa</h2>
    <label>Seu Nick:</label>
    <input type="text" id="nick" placeholder="Digite seu nickname" />
    <button onclick="mostrarAdmin()" style="background:#c0392b;">Mostrar/Ocultar Admin</button>

    <div id="adminSection" style="margin-top:10px;">
      <button onclick="resetarTudo()" style="background:#c0392b;">Resetar Histórico</button>
      <button onclick="eliminarDia()" style="background:#e67e22;">Eliminar Dia Selecionado</button>
      <button onclick="publicarDiscord()">Publicar no Discord</button>
    </div>
  </div>
</div>

<script>
let hidras = parseInt(localStorage.getItem('hidras')) || 0;
let cofresTotais = parseInt(localStorage.getItem('cofresTotais')) || 0;
let countdown;
let tempoRestante = 20 * 60;
let historico = JSON.parse(localStorage.getItem('historico')) || [];

const webhookURL = 'https://discordapp.com/api/webhooks/1446135504868479202/voxMQ-6MyNCg6MvC9Q3Fv-l4Q6jX9qNmQS4edg39_bQFfv_gdr6ha5IjQ9mWSkj4ZkbJ';

function mostrarAdmin() { const section = document.getElementById('adminSection'); section.style.display = section.style.display === 'none' ? 'block' : 'none'; }

function atualizarStats() {
  document.getElementById('hidras').value = hidras;
  document.getElementById('cofresTotal').innerText = cofresTotais;
  document.getElementById('media').innerText = hidras ? (cofresTotais / hidras).toFixed(2) : 0;
  document.getElementById('totalHidras').innerText = hidras;

  let totalWon = 0;
  historico.forEach(h => totalWon += h.profitWon || 0);
  document.getElementById('ganhosWon').innerText = `${totalWon.toFixed(2)} W`;
}

function atualizarDias() {
  const select = document.getElementById('selecionarDia');
  const dias = [...new Set(historico.map(h => h.data))];
  select.innerHTML = '';
  dias.forEach(dia => { const option = document.createElement('option'); option.value = dia; option.textContent = dia; select.appendChild(option); });
  if(dias.length > 0) mostrarDiaSelecionado();
}

function mostrarDiaSelecionado() {
  const dia = document.getElementById('selecionarDia').value;
  const div = document.getElementById('historicoDia');
  div.innerHTML = '';
  historico.filter(h => h.data === dia).forEach(item => {
    const hidraImg = 'https://en-wiki.metin2.gameforge.com/images/thumb/9/9d/Hydra.png/200px-Hydra.png';
    const p = document.createElement('p');
    p.innerHTML = `<img src='${hidraImg}' class='hidra-icon' /> Hidra-${item.id} - <img src='https://metin2cms.cf/items/img/icons/54705.png' class='cofre-icon' /> Cofres: ${item.cofres} (${item.hora}) - Profit: ${item.profit}kk (~${item.profitWon}W)`;
    div.appendChild(p);
  });
}

function registrarHidra() {
  let cofres = parseInt(document.getElementById("cofresInput").value);
  if (isNaN(cofres) || cofres < 0 || cofres > 5) { alert("Insira um valor entre 0 e 5."); return; }

  let precoCofre = parseFloat(document.getElementById('precoCofre').value);
  if (isNaN(precoCofre) || precoCofre < 36 || precoCofre > 40) { alert('Insira o preço médio do cofre entre 36 e 40 kk.'); return; }

  const agora = new Date();
  const hoje = agora.toLocaleDateString('pt-PT');
  const hora = agora.toLocaleTimeString('pt-PT',{hour:'2-digit',minute:'2-digit'});

  const idHidra = hidras + 1;
  let profit = cofres * precoCofre;
  let profitWon = profit / 100;

  historico.push({id: idHidra, cofres, data: hoje, hora, profit, profitWon});

  hidras++;
  cofresTotais += cofres;

  localStorage.setItem('hidras', hidras);
  localStorage.setItem('cofresTotais', cofresTotais);
  localStorage.setItem('historico', JSON.stringify(historico));

  atualizarStats();
  atualizarDias();
  mostrarDiaSelecionado();
  document.getElementById('cofresInput').value = '';
}

function publicarDiscord() {
  const dia = document.getElementById('selecionarDia').value;
  const nick = document.getElementById('nick').value.trim();
  if (!dia || !nick) { alert('Escolha um dia e digite seu nick'); return; }

  const registrosDoDia = historico.filter(h => h.data === dia);
  if (registrosDoDia.length === 0) { alert('Não há registros nesse dia'); return; }

  let mensagem = `**${nick} publicou o dia ${dia}:**\n`;
  let totalWon = 0;
  registrosDoDia.forEach(h => { mensagem += `Hidra-${h.id}: Cofres ${h.cofres} (${h.hora}) - Profit: ${h.profit}kk (~${h.profitWon}W)\n`; totalWon += h.profitWon; });
  mensagem += `\n**Total Profit do dia:** ${totalWon.toFixed(2)}W`;

  fetch(webhookURL, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ content: mensagem }) })
  .then(response => { if(response.ok) { alert('Publicado com sucesso no Discord!'); } else { alert('Erro ao publicar no Discord.'); } })
  .catch(error => { console.error(error); alert('Erro ao publicar no Discord.'); });
}

function iniciarTimer() { clearInterval(countdown); countdown = setInterval(() => { let min = Math.floor(tempoRestante / 60); let sec = tempoRestante % 60; document.getElementById("timer").innerText = `${min}:${sec.toString().padStart(2,'0')}`; if (tempoRestante <= 0) { clearInterval(countdown); alert("O tempo da Hidra acabou! Pode entrar novamente."); } tempoRestante--; }, 1000); }
function pararTimer() { clearInterval(countdown); }
function resetarTimer() { clearInterval(countdown); tempoRestante = 20*60; document.getElementById("timer").innerText = '20:00'; }

function resetarTudo() { if(confirm('Tem certeza que deseja resetar tudo?')) { localStorage.clear(); hidras = 0; cofresTotais = 0; historico = []; atualizarStats(); atualizarDias(); } }
function eliminarDia() { const dia = document.getElementById('selecionarDia').value; if(!dia) { alert('Selecione um dia para eliminar'); return; } if(confirm(`Deseja eliminar todos os registros do dia ${dia}?`)) { historico = historico.filter(h => h.data !== dia); localStorage.setItem('historico', JSON.stringify(historico)); atualizarDias(); } }

window.onload = () => { atualizarStats(); atualizarDias(); mostrarDiaSelecionado(); };
</script>

</body>
</html>
