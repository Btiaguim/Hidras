<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Registo de Hidras - Metin2</title>
<style>
  body { font-family: Arial, sans-serif; background: #1a1a1a; color: #fff; margin:0; padding:0; }
  .banner { width: 100%; max-height: 150px; object-fit: contain; display:block; margin-bottom:10px; }
  .container { display: flex; flex-wrap: wrap; justify-content: space-around; padding: 10px; }
  .section { background: #2b2b2b; padding: 15px; border-radius: 12px; box-shadow: 0 0 10px rgba(0,0,0,0.5); margin:5px; flex:1 1 300px; }
  .section h2 { text-align:center; margin-top:0; }
  button, input, select { color: #fff; background: #3a3a3a; padding: 8px; margin-top: 5px; border-radius: 8px; border: none; font-size: 14px; width: 100%; box-sizing: border-box; }
  button { background: #4CAF50; cursor:pointer; }
  button:hover { background: #45a049; }
  .timer { font-size:32px; text-align:center; display:flex; justify-content:center; margin-top:10px; gap:5px; }
  .digit { background:#3a3a3a; padding:10px 12px; border-radius:8px; }
  .hidra-icon, .cofre-icon { width:20px; height:20px; vertical-align:middle; margin-right:3px; }
  .info-box { background:#3a3a3a; padding:10px; border-radius:8px; margin-top:10px; }
  #chartContainer { margin-top:10px; height:200px; }
  @media(max-width:800px){ .container{flex-direction:column; align-items:center;} }
</style>
</head>
<body>

<img src="https://image.board.gameforge.com/uploads/metin2/de/announcement_metin2_de_b9a65d2955858ca2f0b20ab0e2de48d2.jpg" alt="Banner Hidra Tracker" class="banner" />

<div class="container">

<!-- TIMER -->
<div class="section">
<h2>Timer Hidra</h2>
<label>Defina os minutos:</label>
<input type="number" id="minutosTimer" value="20" min="1" />
<button onclick="iniciarTimer()">Iniciar</button>
<button onclick="pararTimer()">Parar</button>
<button onclick="resetarTimer()">Resetar</button>
<div class="timer" id="timerDisplay"></div>

<div class="info-box">
<h3>Di√°rio</h3>
<p>Total de Hidras Di√°rias: <span id="hidrasDiarias">0</span></p>
<p>Total de Cofres Di√°rios: <span id="cofresDiarias">0</span></p>
<p>Pre√ßo (kk): <input type="number" id="precoCofreDiario" placeholder="30-50" min="30" max="50" /></p>
</div>

<div class="info-box">
<h3>Desde Sempre</h3>
<p>Total de Hidras: <span id="totalHidras">0</span></p>
<p>Total de Cofres: <span id="totalCofres">0</span></p>
<p>Profit: <span id="profitTotal">0 W</span></p>
</div>
</div>

<!-- REGISTRO HIDRAS -->
<div class="section">
<h2>Registrar Hidras</h2>
<label>Cofres Dropados (0-5):</label>
<input type="number" id="cofresInput" placeholder="Digite cofres" min="0" max="5" />
<button onclick="registrarHidra()">Registrar Hidra</button>

<label>Selecionar Dia:</label>
<select id="selecionarDia" onchange="mostrarDiaSelecionado()"></select>

<div id="historicoDia" style="max-height:200px; overflow-y:auto; margin-top:10px;"></div>
</div>

<!-- ADMIN -->
<div class="section">
<h2>√Årea Administrativa</h2>
<label>Seu Nick:</label>
<input type="text" id="nick" placeholder="Digite seu nick" />
<button onclick="mostrarAdmin()">Mostrar/Ocultar Admin</button>
<div id="adminSection" style="margin-top:10px;">
<button onclick="resetarTudo()" style="background:#c0392b;">Resetar Hist√≥rico</button>
<button onclick="eliminarDia()" style="background:#e67e22;">Eliminar Dia Selecionado</button>
<button id="publicar">Publicar no Discord</button>
<canvas id="chartContainer"></canvas>
<button onclick="toggleDarkMode()">Escuro/Claro</button>
</div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let hidras = parseInt(localStorage.getItem('hidras'))||0;
let cofresTotais = parseInt(localStorage.getItem('cofresTotais'))||0;
let historico = JSON.parse(localStorage.getItem('historico'))||[];
let countdown, tempoRestante=0;
const webhookURL = "COLOQUE_SEU_WEBHOOK_AQUI";

function mostrarAdmin(){ const s=document.getElementById('adminSection'); s.style.display = s.style.display==='none'?'block':'none'; }

function atualizarStats(){
  const hoje=new Date().toLocaleDateString('pt-PT');
  const diarios=historico.filter(h=>h.data===hoje);
  let cofresDiarios=0; diarios.forEach(h=>cofresDiarios+=h.cofres);
  document.getElementById('hidrasDiarias').innerText=diarios.length;
  document.getElementById('cofresDiarias').innerText=cofresDiarios;

  // desde sempre
  let totalCofres=0; let totalProfit=0;
  historico.forEach(h=>{totalCofres+=h.cofres; totalProfit+=h.profitWon||0;});
  document.getElementById('totalHidras').innerText=historico.length;
  document.getElementById('totalCofres').innerText=totalCofres;
  document.getElementById('profitTotal').innerText=totalProfit.toFixed(2)+' W';
}

function atualizarDias(){
  const select=document.getElementById('selecionarDia');
  const dias=[...new Set(historico.map(h=>h.data))];
  select.innerHTML='';
  dias.forEach(dia=>{
    const o=document.createElement('option'); o.value=dia; o.textContent=dia; select.appendChild(o);
  });
  if(dias.length>0) mostrarDiaSelecionado();
}

function mostrarDiaSelecionado(){
  const dia=document.getElementById('selecionarDia').value;
  const div=document.getElementById('historicoDia');
  div.innerHTML='';
  const hidraImg='https://en-wiki.metin2.gameforge.com/images/thumb/9/9d/Hydra.png/200px-Hydra.png';
  const diarios=historico.filter(h=>h.data===dia);
  diarios.forEach((item,i)=>{
    const p=document.createElement('p');
    p.innerHTML=`<img src='${hidraImg}' class='hidra-icon' /> Hidra-${i+1} - <img src='https://metin2cms.cf/items/img/icons/54705.png' class='cofre-icon' /> Cofres: ${item.cofres} - Profit: ${item.profit}kk (~${item.profitWon}W)`;
    div.appendChild(p);
  });
}

function registrarHidra(){
  let cofres=parseInt(document.getElementById("cofresInput").value);
  let preco=parseFloat(document.getElementById("precoCofreDiario").value);
  if(isNaN(cofres)||cofres<0||cofres>5)return alert("Cofres 0-5");
  if(isNaN(preco)||preco<30||preco>50)return alert("Pre√ßo 30-50kk");
  const hoje=new Date().toLocaleDateString('pt-PT');
  const idHidra=historico.filter(h=>h.data===hoje).length+1;
  let profit=cofres*preco; let profitWon=profit/100;
  historico.push({id:idHidra,cofres,data:hoje,profit,profitWon});
  localStorage.setItem('historico',JSON.stringify(historico));
  atualizarStats(); atualizarDias(); mostrarDiaSelecionado();
  document.getElementById('cofresInput').value='';
}

// TIMER
function iniciarTimer(){
  let minutos=parseInt(document.getElementById('minutosTimer').value);
  if(isNaN(minutos)||minutos<=0)minutos=20;
  let fim=localStorage.getItem('timerFim');
  if(!fim||tempoRestante<=0){ fim=Date.now()+minutos*60000; localStorage.setItem('timerFim',fim); }
  fim=parseInt(fim); clearInterval(countdown);
  countdown=setInterval(()=>{
    const restante=Math.max(0,Math.floor((fim-Date.now())/1000));
    const min=Math.floor(restante/60); const sec=restante%60;
    document.getElementById('timerDisplay').innerHTML=`<span class="digit">${min}</span>:<span class="digit">${sec.toString().padStart(2,'0')}</span>`;
    tempoRestante=restante;
    if(restante<=0){ clearInterval(countdown); localStorage.removeItem('timerFim'); playAlarm(); notifyWindows(); }
  },1000);
}
function pararTimer(){ clearInterval(countdown); }
function resetarTimer(){ clearInterval(countdown); tempoRestante=0; document.getElementById('timerDisplay').innerHTML='20:00'; localStorage.removeItem('timerFim'); }

// ADMIN
function resetarTudo(){ if(confirm('Tem certeza que deseja resetar tudo?')){ localStorage.clear(); historico=[]; atualizarStats(); atualizarDias(); mostrarDiaSelecionado(); } }
function eliminarDia(){ const dia=document.getElementById('selecionarDia').value; if(!dia)return alert("Selecione dia"); if(confirm("Deseja eliminar esse dia?")){ historico=historico.filter(h=>h.data!==dia); localStorage.setItem('historico',JSON.stringify(historico)); atualizarStats(); atualizarDias(); mostrarDiaSelecionado(); } }

// PUBLICAR DISCORD
document.getElementById("publicar").addEventListener("click",()=>{
  const nick=document.getElementById('nick').value.trim(); if(!nick)return alert("Digite nick");
  const dia=document.getElementById('selecionarDia').value; if(!dia)return alert("Escolha dia");
  const dadosDia=historico.filter(h=>h.data===dia);
  let totalCofres=0,totalWon=0,texto="";
  dadosDia.forEach(h=>{ totalCofres+=h.cofres; totalWon+=h.profitWon; texto+=`‚Ä¢ Hidra-${h.id}: ${h.cofres} cofres\n`; });
  const payload={content:`üì¢ ${nick} publicou Hidras!`,embeds:[{title:`Dia ${dia}`,color:3066993,fields:[{name:"Jogador",value:nick},{name:"Hidras",value:dadosDia.length},{name:"Cofres",value:totalCofres},{name:"Profit",value:totalWon.toFixed(2)+' W'},{name:"Detalhes",value:texto}],footer:{text:"Hidra Tracker"}}]};
  fetch(webhookURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)}).then(r=>r.ok?alert("Publicado"):alert("Erro"));
});

// DARK MODE
function toggleDarkMode(){
  document.body.classList.toggle('darkMode');
  document.querySelectorAll('.section, .info-box').forEach(e=>{e.style.background=document.body.classList.contains('darkMode')?'#2b2b2b':'#3a3a3a';});
}

// NOTIFICA√á√ÉO WINDOWS
function notifyWindows(){
  if(Notification.permission!=='granted')Notification.requestPermission();
  else new Notification("Hidra Tracker",{body:"O tempo da Hidra acabou!",icon:"https://en-wiki.metin2.gameforge.com/images/thumb/9/9d/Hydra.png/200px-Hydra.png"});
}
function playAlarm(){ const audio=new Audio('https://www.soundjay.com/buttons/sounds/beep-07.mp3'); audio.play(); }

window.onload=()=>{
  const fim=localStorage.getItem('timerFim');
  if(fim){ tempoRestante=Math.max(0,Math.floor((fim-Date.now())/1000)); if(tempoRestante>0) iniciarTimer(); }
  atualizarStats(); atualizarDias(); mostrarDiaSelecionado();
};
</script>

</body>
</html>
