/* -------------------- TIMER -------------------- */

function iniciarTimer() {
  let minutos = parseInt(document.getElementById('minutosTimer').value);
  if(isNaN(minutos) || minutos <= 0) minutos = 20;

  let fim = localStorage.getItem('timerFim');
  if(!fim || tempoRestante <= 0){
    fim = Date.now() + minutos*60000;
    localStorage.setItem('timerFim', fim);
  }

  fim = parseInt(fim);
  clearInterval(countdown);

  // pedir permissão de notificações
  if ("Notification" in window && Notification.permission !== "granted") {
    Notification.requestPermission();
  }

  countdown = setInterval(()=>{
    const restante = Math.max(0, Math.floor((fim - Date.now())/1000));
    const min = Math.floor(restante/60);
    const sec = restante % 60;

    document.getElementById('timer').innerText = `${min}:${sec.toString().padStart(2,'0')}`;
    tempoRestante = restante;

    if(restante <= 0){
      clearInterval(countdown);
      localStorage.removeItem('timerFim');
      alert('O tempo da Hidra acabou!');

      // notificação para Windows
      if (Notification.permission === "granted") {
        new Notification("Hidra Timer", {
          body: "O tempo da Hidra acabou! Pode entrar novamente.",
          icon: "https://en-wiki.metin2.gameforge.com/images/thumb/9/9d/Hydra.png/200px-Hydra.png"
        });
      }
    }
  },1000);
}

function pararTimer(){
  clearInterval(countdown);
}

function resetarTimer(){
  clearInterval(countdown);
  tempoRestante = 0;
  document.getElementById('timer').innerText = '20:00';
  localStorage.removeItem('timerFim');
}
